import{a as Z,b as $,c as te,d as ie}from"./chunk-NE7GZ4P3.js";import{a as K}from"./chunk-2G5LAZZT.js";import"./chunk-HNYYVXMR.js";import{a as Y}from"./chunk-2ZUFPCVZ.js";import{a as oe}from"./chunk-4CHXPSIC.js";import{a as W,b as M,e as X}from"./chunk-XMZP254X.js";import{b as J,d as z}from"./chunk-7Q4JSMIS.js";import{a as ee}from"./chunk-H6J2F3XK.js";import{b as Q,c as N,d as _,e as k,f as D,g as E,h as g,i as T,k as B,l as U,n as A}from"./chunk-QFX2EMHE.js";import{$ as x,$a as v,Aa as f,La as c,Pa as b,Qa as y,Sa as p,Vb as H,Wa as n,Xa as r,Xb as L,Ya as u,Za as R,ab as h,hc as I,ia as j,ic as P,ja as G,kb as s,lb as w,mb as m,ob as S,qb as F,tb as l,ub as d,za as i}from"./chunk-6HVPCAXH.js";import"./chunk-2VMXMS7J.js";function me(t,o){if(t&1&&(n(0,"p",11),s(1),l(2,"translate"),r()),t&2){let e=h(2);i(),w(d(2,1,"errors."+e.error.message))}}function pe(t,o){t&1&&(n(0,"div",16),s(1),l(2,"translate"),r()),t&2&&(i(),m(" ",d(2,1,"errors.required")," "))}function ce(t,o){t&1&&(n(0,"div",16),s(1),l(2,"translate"),r()),t&2&&(i(),m(" ",d(2,1,"errors.required")," "))}function ue(t,o){t&1&&(s(0),l(1,"translate")),t&2&&m(" ",d(1,1,"errors.required")," ")}function fe(t,o){t&1&&(s(0),l(1,"translate")),t&2&&m(" ",d(1,1,"errors.not-match")," ")}function ve(t,o){if(t&1&&(n(0,"div",16),c(1,ue,2,3)(2,fe,2,3),r()),t&2){let e=h(2);i(),p(e.controls.repeatPassword.errors.required?1:-1),i(),p(e.controls.repeatPassword.errors.matching?2:-1)}}function ge(t,o){if(t&1){let e=R();n(0,"form",9),v("ngSubmit",function(){j(e);let C=h();return G(C.submit())}),n(1,"div",10),c(2,me,3,3,"p",11),n(3,"div",12)(4,"div",13)(5,"label",14),s(6),l(7,"translate"),r(),u(8,"input",15),c(9,pe,3,3,"div",16),r()(),n(10,"div",12)(11,"div",13)(12,"label",17),s(13),l(14,"translate"),r(),u(15,"input",18),c(16,ce,3,3,"div",16),r()(),n(17,"div",12)(18,"div",13)(19,"label",19),s(20),l(21,"translate"),r(),u(22,"input",20),c(23,ve,3,2,"div",16),r()()(),n(24,"div",21)(25,"button",22),s(26),l(27,"translate"),r()()()}if(t&2){let e=h();b("formGroup",e.changePasswordForm),i(2),p(e.error?2:-1),i(4),m(" ",d(7,15,"user.current-password")," "),i(2),y("is-invalid",e.submitted&&e.controls.currentPassword.errors),i(),p(e.submitted&&e.controls.currentPassword.errors?9:-1),i(4),m(" ",d(14,17,"user.password")," "),i(2),y("is-invalid",e.submitted&&e.controls.newPassword.errors),i(),p(e.submitted&&e.controls.newPassword.errors?16:-1),i(4),m(" ",d(21,19,"user.confirm-password")," "),i(2),y("is-invalid",e.submitted&&e.controls.repeatPassword.errors),i(),p(e.submitted&&e.controls.repeatPassword.errors?23:-1),i(3),m(" ",d(27,21,"action.submit")," ")}}var q=class t{constructor(o,e,a){this.modalService=o;this.authService=e;this.tokenHelperService=a}submitted=!1;changePasswordForm=new E({id:new g(null),currentPassword:new g(null,[_.required]),newPassword:new g(null,[_.required]),repeatPassword:new g(null,[_.required])},{validators:[Z("newPassword","repeatPassword")]});userId;error;ngOnInit(){this.controls.id.setValue(this.userId)}get controls(){return this.changePasswordForm.controls}dismiss(){this.modalService.dismissAll()}submit(){if(this.changePasswordForm.invalid){this.submitted=!0;return}let o=Object.assign(this.changePasswordForm.value);this.changePassword(o)}changePassword(o){this.authService.changePassword(o).subscribe({next:e=>{e&&(localStorage.setItem("token",e),this.tokenHelperService.decodeJwt()),this.dismiss()},error:e=>{this.error=JSON.parse(e.error)}})}static \u0275fac=function(e){return new(e||t)(f(M),f(ie),f(K))};static \u0275cmp=x({type:t,selectors:[["app-new-password"]],standalone:!0,features:[S],decls:13,vars:4,consts:[[1,"modal","fade","show",2,"display","block","padding-right","15px"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header","d-flex","justify-content-between"],[1,"modal-title"],[1,"fa","fa-warning","text-warning",2,"margin-right","7px","color","blue"],["type","button","data-dismiss","modal","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"modal-body"],[1,"text-danger"],[1,"col-12"],[1,"form-group","mt-3"],["for","currentPassword",1,"form-label"],["type","password","formControlName","currentPassword","id","currentPassword","autocomplete","false","showHidePassword","",1,"form-control"],[1,"invalid-feedback"],["for","password",1,"form-label"],["type","password","formControlName","newPassword","id","password","autocomplete","false","showHidePassword","",1,"form-control"],["for","repeatPassword",1,"form-label"],["type","password","formControlName","repeatPassword","id","repeatPassword","autocomplete","false","showHidePassword","",1,"form-control"],[1,"modal-footer"],["type","submit",1,"btn","btn-outline-primary"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),u(5,"i",5),n(6,"span"),s(7),l(8,"translate"),r()(),n(9,"button",6),v("click",function(){return a.dismiss()}),n(10,"span",7),s(11,"\xD7"),r()()(),c(12,ge,28,23,"form",8),r()()()),e&2&&(i(7),w(d(8,2,"user.change-password")),i(5),p(a.changePasswordForm?12:-1))},dependencies:[A,T,N,k,D,B,U,P,I,te],encapsulation:2})};var V=class t{constructor(o){this.modalService=o}ngOnInit(){}approve(){this.modalService.close(!0)}dismiss(){this.modalService.close(!1)}static \u0275fac=function(e){return new(e||t)(f(W))};static \u0275cmp=x({type:t,selectors:[["app-confirm-dialog"]],standalone:!0,features:[S],decls:25,vars:12,consts:[[1,"modal","fade","show",2,"display","block","padding-right","15px"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"fa","fa-warning","text-warning",2,"margin-right","7px","color","blue"],["type","button","data-dismiss","modal","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"text-center","text-success",2,"font-size","5.5rem"],[1,"fa-solid","fa-envelope-circle-check"],[1,"text-muted","text-center"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-outline-danger",3,"click"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),u(5,"i",5),n(6,"span"),s(7),l(8,"translate"),r()(),n(9,"button",6),v("click",function(){return a.dismiss()}),n(10,"span",7),s(11,"\xD7"),r()()(),n(12,"div",8)(13,"p",9),u(14,"i",10),r(),n(15,"p",11),s(16),l(17,"translate"),r()(),n(18,"div",12)(19,"button",13),v("click",function(){return a.approve()}),s(20),l(21,"translate"),r(),n(22,"button",14),v("click",function(){return a.dismiss()}),s(23),l(24,"translate"),r()()()()()),e&2&&(i(7),w(d(8,4,"user.confirm-dialog")),i(9),m(" ",d(17,6,"user.confirm-message")," "),i(4),m(" ",d(21,8,"action.yes")," "),i(3),m(" ",d(24,10,"action.no")," "))},dependencies:[P,I],encapsulation:2})};var O=t=>({"is-invalid":t});function be(t,o){if(t&1&&(n(0,"p",2),s(1),l(2,"translate"),r()),t&2){let e=h();i(),w(d(2,1,"errors."+e.error.message))}}function Ce(t,o){t&1&&(n(0,"div",9),s(1),l(2,"translate"),r()),t&2&&(i(),m(" ",d(2,1,"error.required")," "))}function he(t,o){t&1&&(s(0),l(1,"translate")),t&2&&m(" ",d(1,1,"error.required")," ")}function _e(t,o){t&1&&(s(0),l(1,"translate")),t&2&&m(" ",d(1,1,"error.email-invalid")," ")}function we(t,o){if(t&1&&(n(0,"div",9),c(1,he,2,3)(2,_e,2,3),r()),t&2){let e=h();i(),p(e.controls.email.errors.required?1:-1),i(),p(e.controls.email.errors.email?2:-1)}}function xe(t,o){t&1&&(n(0,"div",9),s(1),l(2,"translate"),r()),t&2&&(i(),m(" ",d(2,1,"error.required")," "))}function Se(t,o){if(t&1&&c(0,xe,3,3,"div",9),t&2){let e=h();p(e.controls.roleId.errors.required?0:-1)}}var le=class t{constructor(o,e,a,C,Ie){this.modalService=o;this.route=e;this.lookupService=a;this.userService=C;this.router=Ie}userId;submitted=!1;userForm=new E({id:new g(0),fullName:new g(null,[_.required]),roleId:new g(null,_.required),email:new g(null,[_.required,$()]),isActive:new g(!0,[_.required])});roles=[];error;ngOnInit(){this.userId=this.route.snapshot.params.id,this.getRoles(),this.getUser()}getRoles(){this.lookupService.getRoles().subscribe(o=>{this.roles=o})}get controls(){return this.userForm.controls}getUser(){this.userId&&this.userService.getUserById(this.userId).subscribe(o=>this.populateUserForm(o))}populateUserForm(o){this.userForm.patchValue({id:o.id,fullName:o.fullName,email:o.email,roleId:o.roleId,isActive:o.isActive})}openChangePassword(){let o=this.modalService.open(q);o.componentInstance.userId=this.userId}deleteUser(){this.modalService.open(V).result.then(e=>{e&&this.userService.delete(this.userId).subscribe(()=>{this.router.navigateByUrl("dashboard/users")})})}get isAdmin(){return this.roles.find(o=>o.id==this.controls.roleId.value)?.name=="Admin"}submit(){if(this.submitted=!0,this.userForm.valid){let o=Object.assign(this.userForm.value);o.id?this.userService.update(o).subscribe(()=>{}):this.userService.create(o).subscribe({next:()=>{this.router.navigateByUrl("dashboard/users")},error:e=>{try{this.error=JSON.parse(e.error)}catch{this.error=e.error}}})}}static \u0275fac=function(e){return new(e||t)(f(M),f(J),f(oe),f(Y),f(z))};static \u0275cmp=x({type:t,selectors:[["app-user-form"]],standalone:!0,features:[S],decls:45,vars:42,consts:[[3,"ngSubmit","formGroup"],[1,"row","p-5"],[1,"text-danger"],[1,"h4"],[1,"fa","fa-user-o","userIcon"],[1,"col-sm-12","col-md-6","col-lg-6"],[1,"form-group","mt-3"],["for","firstName",1,"form-label"],["type","text","formControlName","fullName","id","fullName","autocomplete","false",1,"form-control",3,"ngClass"],[1,"invalid-feedback"],["for","email",1,"form-label"],["type","text","formControlName","email","id","email","autocomplete","false",1,"form-control",3,"ngClass"],["for","role",1,"form-label"],["key","id","name","name","formControlName","roleId",3,"options","value"],[1,"form-group","mt-5"],["type","checkbox","formControlName","isActive","id","isActive","autocomplete","false",1,"form-check-input",3,"ngClass"],["for","isActive",1,"form-check-label","ms-3"],[1,"col-sm-12","col-md-12","col-lg-12"],["type","submit",1,"btn","btn-outline-primary","me-3"],["type","button",1,"btn","btn-outline-primary","me-3",3,"click","disabled"],["type","button",1,"btn","btn-outline-danger",3,"click","disabled"]],template:function(e,a){e&1&&(n(0,"form",0),v("ngSubmit",function(){return a.submit()}),n(1,"div",1),c(2,be,3,3,"p",2),n(3,"h1",3),u(4,"i",4),s(5),l(6,"translate"),r(),n(7,"div",5)(8,"div",6)(9,"label",7),s(10),l(11,"translate"),r(),u(12,"input",8),c(13,Ce,3,3,"div",9),r()(),n(14,"div",5)(15,"div",6)(16,"label",10),s(17),l(18,"translate"),r(),u(19,"input",11),c(20,we,3,2,"div",9),r()(),n(21,"div",5)(22,"div",6)(23,"label",12),s(24),l(25,"translate"),r(),u(26,"app-select",13),c(27,Se,1,1),r()(),n(28,"div",5)(29,"div",14),u(30,"input",15),n(31,"label",16),s(32),l(33,"translate"),r()()(),n(34,"div",17)(35,"div",6)(36,"button",18),s(37),l(38,"translate"),r(),n(39,"button",19),v("click",function(){return a.openChangePassword()}),s(40),l(41,"translate"),r(),n(42,"button",20),v("click",function(){return a.deleteUser()}),s(43),l(44,"translate"),r()()()()()),e&2&&(b("formGroup",a.userForm),i(2),p(a.error?2:-1),i(3),m(" ",d(6,20,"user.user-profile")," "),i(5),m(" ",d(11,22,"user.full-name")," "),i(2),b("ngClass",F(36,O,a.submitted&&a.controls.fullName.errors)),i(),p(a.submitted&&a.controls.fullName.errors?13:-1),i(4),m(" ",d(18,24,"user.email")," "),i(2),b("ngClass",F(38,O,a.submitted&&a.controls.email.errors)),i(),p(a.submitted&&a.controls.email.errors?20:-1),i(4),m(" ",d(25,26,"user.role")," "),i(2),b("options",a.roles)("value",a.controls.roleId.value),i(),p(a.submitted&&a.controls.roleId.errors?27:-1),i(3),b("ngClass",F(40,O,a.submitted&&a.controls.isActive.errors)),i(2),m(" ",d(33,28,"user.is-active")," "),i(5),m(" ",d(38,30,"action.submit")," "),i(2),b("disabled",!a.controls.id.value),i(),m(" ",d(41,32,"user.change-password")," "),i(2),b("disabled",!a.controls.id.value||a.isAdmin),i(),m(" ",d(44,34,"action.delete")," "))},dependencies:[P,I,A,T,N,Q,k,D,B,U,L,H,ee,X],encapsulation:2})};export{le as UserFormComponent};
